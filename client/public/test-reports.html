<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports UI Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .report-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            background: #f8f9fa;
        }
        .filters {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .filters input, .filters select {
            margin: 5px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .chart-container {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            background: #f8f9fa;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            padding: 15px;
            background: #e9ecef;
            border-radius: 5px;
            text-align: center;
        }
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #495057;
        }
        .report-options {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        .export-options {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Reports UI Test Page</h1>
        
        <div class="test-section">
            <h3>Authentication</h3>
            <div>
                <input type="text" id="username" placeholder="Username" value="admin">
                <input type="password" id="password" placeholder="Password" value="admin123">
                <button onclick="login()">Login</button>
                <button onclick="logout()">Logout</button>
            </div>
            <div id="authResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>Dashboard Reports</h3>
            <div class="filters">
                <select id="dashboardMetric">
                    <option value="users">Active Users</option>
                    <option value="beneficiaries">Beneficiaries Progress</option>
                    <option value="assessments">Assessment Results</option>
                    <option value="appointments">Appointment Statistics</option>
                </select>
                <input type="date" id="dashboardStartDate">
                <input type="date" id="dashboardEndDate">
                <button onclick="generateDashboardReport()">Generate Report</button>
            </div>
            <div id="dashboardResult" class="result"></div>
            <div class="chart-container" id="dashboardChart">
                <p>Chart will appear here</p>
            </div>
            <div class="stats-grid" id="dashboardStats"></div>
        </div>

        <div class="test-section">
            <h3>Beneficiary Reports</h3>
            <div class="filters">
                <input type="text" id="beneficiaryId" placeholder="Beneficiary ID (optional)">
                <select id="beneficiaryReportType">
                    <option value="progress">Progress Report</option>
                    <option value="assessment">Assessment History</option>
                    <option value="attendance">Attendance Report</option>
                    <option value="comprehensive">Comprehensive Report</option>
                </select>
                <input type="date" id="beneficiaryStartDate">
                <input type="date" id="beneficiaryEndDate">
                <button onclick="generateBeneficiaryReport()">Generate Report</button>
            </div>
            <div id="beneficiaryResult" class="result"></div>
            <div id="beneficiaryReportContent"></div>
        </div>

        <div class="test-section">
            <h3>Program Reports</h3>
            <div class="filters">
                <input type="text" id="programId" placeholder="Program ID">
                <select id="programReportType">
                    <option value="participants">Participant Summary</option>
                    <option value="outcomes">Outcome Analysis</option>
                    <option value="engagement">Engagement Metrics</option>
                    <option value="financials">Financial Summary</option>
                </select>
                <button onclick="generateProgramReport()">Generate Report</button>
            </div>
            <div id="programResult" class="result"></div>
            <div id="programReportContent"></div>
        </div>

        <div class="test-section">
            <h3>Custom Reports</h3>
            <div class="filters">
                <select id="customReportType">
                    <option value="monthly_summary">Monthly Summary</option>
                    <option value="quarterly_review">Quarterly Review</option>
                    <option value="annual_report">Annual Report</option>
                    <option value="ad_hoc">Ad Hoc Report</option>
                </select>
                <div class="report-options">
                    <label>
                        <input type="checkbox" id="includeCharts"> Include Charts
                    </label>
                    <label>
                        <input type="checkbox" id="includeStats"> Include Statistics
                    </label>
                    <label>
                        <input type="checkbox" id="includeDetails"> Include Details
                    </label>
                </div>
                <button onclick="generateCustomReport()">Generate Report</button>
            </div>
            <div id="customResult" class="result"></div>
            <div id="customReportContent"></div>
        </div>

        <div class="test-section">
            <h3>Scheduled Reports</h3>
            <div>
                <input type="text" id="reportName" placeholder="Report name">
                <select id="scheduleFrequency">
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                    <option value="quarterly">Quarterly</option>
                </select>
                <input type="email" id="scheduleEmail" placeholder="Email recipients">
                <button onclick="scheduleReport()">Schedule Report</button>
            </div>
            <div id="scheduleResult" class="result"></div>
            <div id="scheduledReportsList"></div>
        </div>

        <div class="test-section">
            <h3>Report Export</h3>
            <div class="export-options">
                <select id="exportFormat">
                    <option value="pdf">PDF</option>
                    <option value="excel">Excel</option>
                    <option value="csv">CSV</option>
                    <option value="json">JSON</option>
                </select>
                <input type="text" id="exportReportId" placeholder="Report ID">
                <button onclick="exportReport()">Export Report</button>
            </div>
            <div id="exportResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>Report Templates</h3>
            <div>
                <select id="templateType">
                    <option value="monthly_summary">Monthly Summary Template</option>
                    <option value="beneficiary_progress">Beneficiary Progress Template</option>
                    <option value="program_outcomes">Program Outcomes Template</option>
                    <option value="executive_summary">Executive Summary Template</option>
                </select>
                <button onclick="loadTemplate()">Load Template</button>
                <button onclick="saveTemplate()">Save as Template</button>
            </div>
            <div id="templateResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>Report History</h3>
            <div class="filters">
                <input type="text" id="historySearch" placeholder="Search reports...">
                <select id="historyType">
                    <option value="">All Types</option>
                    <option value="dashboard">Dashboard</option>
                    <option value="beneficiary">Beneficiary</option>
                    <option value="program">Program</option>
                    <option value="custom">Custom</option>
                </select>
                <button onclick="getReportHistory()">Get History</button>
            </div>
            <div id="historyResult" class="result"></div>
            <div id="reportHistoryList"></div>
        </div>

        <div class="test-section">
            <h3>Test Suite</h3>
            <button onclick="runAllTests()">Run All Tests</button>
            <div id="suiteResult" class="result"></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3001/api';
        let authToken = localStorage.getItem('authToken') || '';

        // Authentication
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                if (response.ok) {
                    authToken = data.token;
                    localStorage.setItem('authToken', authToken);
                    showResult('authResult', 'Login successful', 'success');
                } else {
                    showResult('authResult', `Login failed: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('authResult', `Error: ${error.message}`, 'error');
            }
        }

        async function logout() {
            authToken = '';
            localStorage.removeItem('authToken');
            showResult('authResult', 'Logged out', 'success');
        }

        // Dashboard Reports
        async function generateDashboardReport() {
            const metric = document.getElementById('dashboardMetric').value;
            const startDate = document.getElementById('dashboardStartDate').value;
            const endDate = document.getElementById('dashboardEndDate').value;
            
            const params = new URLSearchParams({
                metric,
                start_date: startDate,
                end_date: endDate
            });
            
            try {
                const response = await fetch(`${API_URL}/reports/dashboard?${params}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                if (response.ok) {
                    showResult('dashboardResult', 'Dashboard report generated', 'success');
                    displayDashboardReport(data);
                } else {
                    showResult('dashboardResult', `Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('dashboardResult', `Error: ${error.message}`, 'error');
            }
        }

        function displayDashboardReport(data) {
            // Display chart placeholder
            document.getElementById('dashboardChart').innerHTML = `
                <div style="text-align: center;">
                    <h4>${data.title}</h4>
                    <p>Chart: ${data.chart_type}</p>
                    <p>Data points: ${data.data_points?.length || 0}</p>
                </div>
            `;
            
            // Display stats
            const statsContainer = document.getElementById('dashboardStats');
            if (data.stats) {
                statsContainer.innerHTML = Object.entries(data.stats).map(([key, value]) => `
                    <div class="stat-card">
                        <h4>${key.replace(/_/g, ' ').toUpperCase()}</h4>
                        <div class="stat-value">${value}</div>
                    </div>
                `).join('');
            }
        }

        // Beneficiary Reports
        async function generateBeneficiaryReport() {
            const beneficiaryId = document.getElementById('beneficiaryId').value;
            const reportType = document.getElementById('beneficiaryReportType').value;
            const startDate = document.getElementById('beneficiaryStartDate').value;
            const endDate = document.getElementById('beneficiaryEndDate').value;
            
            const params = new URLSearchParams({
                report_type: reportType,
                start_date: startDate,
                end_date: endDate
            });
            if (beneficiaryId) params.append('beneficiary_id', beneficiaryId);
            
            try {
                const response = await fetch(`${API_URL}/reports/beneficiary?${params}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                if (response.ok) {
                    showResult('beneficiaryResult', 'Beneficiary report generated', 'success');
                    displayBeneficiaryReport(data);
                } else {
                    showResult('beneficiaryResult', `Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('beneficiaryResult', `Error: ${error.message}`, 'error');
            }
        }

        function displayBeneficiaryReport(data) {
            const container = document.getElementById('beneficiaryReportContent');
            container.innerHTML = `
                <div class="report-card">
                    <h4>${data.title}</h4>
                    <p>Report Type: ${data.report_type}</p>
                    <p>Period: ${data.start_date} to ${data.end_date}</p>
                    ${data.summary ? `
                        <div>
                            <h5>Summary</h5>
                            <ul>
                                ${Object.entries(data.summary).map(([key, value]) => 
                                    `<li>${key}: ${value}</li>`
                                ).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    ${data.charts ? `
                        <div>
                            <h5>Charts</h5>
                            <p>${data.charts.length} charts generated</p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Program Reports
        async function generateProgramReport() {
            const programId = document.getElementById('programId').value;
            const reportType = document.getElementById('programReportType').value;
            
            try {
                const response = await fetch(`${API_URL}/reports/program/${programId}?type=${reportType}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                if (response.ok) {
                    showResult('programResult', 'Program report generated', 'success');
                    displayProgramReport(data);
                } else {
                    showResult('programResult', `Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('programResult', `Error: ${error.message}`, 'error');
            }
        }

        function displayProgramReport(data) {
            const container = document.getElementById('programReportContent');
            container.innerHTML = `
                <div class="report-card">
                    <h4>${data.title}</h4>
                    <p>Program: ${data.program_name}</p>
                    <p>Type: ${data.report_type}</p>
                    ${data.metrics ? `
                        <div>
                            <h5>Key Metrics</h5>
                            <ul>
                                ${Object.entries(data.metrics).map(([key, value]) => 
                                    `<li>${key}: ${value}</li>`
                                ).join('')}
                            </ul>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Custom Reports
        async function generateCustomReport() {
            const reportType = document.getElementById('customReportType').value;
            const includeCharts = document.getElementById('includeCharts').checked;
            const includeStats = document.getElementById('includeStats').checked;
            const includeDetails = document.getElementById('includeDetails').checked;
            
            const reportData = {
                type: reportType,
                options: {
                    include_charts: includeCharts,
                    include_stats: includeStats,
                    include_details: includeDetails
                }
            };
            
            try {
                const response = await fetch(`${API_URL}/reports/custom`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(reportData)
                });
                
                const data = await response.json();
                if (response.ok) {
                    showResult('customResult', 'Custom report generated', 'success');
                    displayCustomReport(data);
                } else {
                    showResult('customResult', `Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('customResult', `Error: ${error.message}`, 'error');
            }
        }

        function displayCustomReport(data) {
            const container = document.getElementById('customReportContent');
            container.innerHTML = `
                <div class="report-card">
                    <h4>${data.title}</h4>
                    <p>Generated: ${new Date(data.generated_at).toLocaleString()}</p>
                    <p>Sections included: ${data.sections?.join(', ') || 'None'}</p>
                    ${data.preview ? `
                        <div>
                            <h5>Preview</h5>
                            <p>${data.preview}</p>
                        </div>
                    ` : ''}
                    <button onclick="exportReport('${data.id}')">Export Report</button>
                </div>
            `;
        }

        // Scheduled Reports
        async function scheduleReport() {
            const reportData = {
                name: document.getElementById('reportName').value,
                frequency: document.getElementById('scheduleFrequency').value,
                recipients: document.getElementById('scheduleEmail').value.split(',').map(e => e.trim())
            };
            
            try {
                const response = await fetch(`${API_URL}/reports/schedule`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(reportData)
                });
                
                const data = await response.json();
                if (response.ok) {
                    showResult('scheduleResult', 'Report scheduled successfully', 'success');
                    getScheduledReports();
                } else {
                    showResult('scheduleResult', `Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('scheduleResult', `Error: ${error.message}`, 'error');
            }
        }

        async function getScheduledReports() {
            try {
                const response = await fetch(`${API_URL}/reports/scheduled`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                if (response.ok) {
                    displayScheduledReports(data.reports);
                }
            } catch (error) {
                console.error('Error fetching scheduled reports:', error);
            }
        }

        function displayScheduledReports(reports) {
            const container = document.getElementById('scheduledReportsList');
            if (!reports || reports.length === 0) {
                container.innerHTML = '<p>No scheduled reports</p>';
                return;
            }
            
            container.innerHTML = reports.map(report => `
                <div class="report-card">
                    <h5>${report.name}</h5>
                    <p>Frequency: ${report.frequency}</p>
                    <p>Recipients: ${report.recipients.join(', ')}</p>
                    <p>Next Run: ${new Date(report.next_run).toLocaleString()}</p>
                    <button onclick="cancelSchedule('${report.id}')" class="danger">Cancel</button>
                </div>
            `).join('');
        }

        // Export Report
        async function exportReport(reportId) {
            if (!reportId) {
                reportId = document.getElementById('exportReportId').value;
            }
            
            const format = document.getElementById('exportFormat').value;
            
            try {
                const response = await fetch(`${API_URL}/reports/${reportId}/export?format=${format}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `report-${reportId}.${format}`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    showResult('exportResult', 'Report exported successfully', 'success');
                } else {
                    const data = await response.json();
                    showResult('exportResult', `Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('exportResult', `Error: ${error.message}`, 'error');
            }
        }

        // Templates
        async function loadTemplate() {
            const templateType = document.getElementById('templateType').value;
            
            try {
                const response = await fetch(`${API_URL}/reports/templates/${templateType}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                if (response.ok) {
                    showResult('templateResult', 'Template loaded', 'success');
                    // Would populate form with template settings
                } else {
                    showResult('templateResult', `Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('templateResult', `Error: ${error.message}`, 'error');
            }
        }

        async function saveTemplate() {
            const templateData = {
                name: document.getElementById('templateType').value,
                // Would include current report settings
            };
            
            try {
                const response = await fetch(`${API_URL}/reports/templates`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(templateData)
                });
                
                const data = await response.json();
                if (response.ok) {
                    showResult('templateResult', 'Template saved', 'success');
                } else {
                    showResult('templateResult', `Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('templateResult', `Error: ${error.message}`, 'error');
            }
        }

        // Report History
        async function getReportHistory() {
            const search = document.getElementById('historySearch').value;
            const type = document.getElementById('historyType').value;
            
            const params = new URLSearchParams();
            if (search) params.append('search', search);
            if (type) params.append('type', type);
            
            try {
                const response = await fetch(`${API_URL}/reports/history?${params}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                if (response.ok) {
                    showResult('historyResult', `Found ${data.reports.length} reports`, 'success');
                    displayReportHistory(data.reports);
                } else {
                    showResult('historyResult', `Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('historyResult', `Error: ${error.message}`, 'error');
            }
        }

        function displayReportHistory(reports) {
            const container = document.getElementById('reportHistoryList');
            if (!reports || reports.length === 0) {
                container.innerHTML = '<p>No reports found</p>';
                return;
            }
            
            container.innerHTML = reports.map(report => `
                <div class="report-card">
                    <h5>${report.title}</h5>
                    <p>Type: ${report.type}</p>
                    <p>Generated: ${new Date(report.created_at).toLocaleString()}</p>
                    <p>By: ${report.created_by}</p>
                    <button onclick="viewReport('${report.id}')">View</button>
                    <button onclick="exportReport('${report.id}')">Export</button>
                </div>
            `).join('');
        }

        // Test suite
        async function runAllTests() {
            const results = [];
            
            // Test 1: Authentication
            results.push(await testAuth());
            
            // Test 2: Dashboard reports
            results.push(await testDashboard());
            
            // Test 3: Beneficiary reports
            results.push(await testBeneficiary());
            
            // Test 4: Program reports
            results.push(await testProgram());
            
            // Test 5: Custom reports
            results.push(await testCustom());
            
            // Test 6: Templates
            results.push(await testTemplates());
            
            // Display results
            const passed = results.filter(r => r.status === 'pass').length;
            const failed = results.filter(r => r.status === 'fail').length;
            
            const summary = `
                <h4>Test Results: ${passed} passed, ${failed} failed</h4>
                ${results.map(r => `
                    <div class="${r.status === 'pass' ? 'success' : 'error'}">
                        ${r.name}: ${r.message}
                    </div>
                `).join('')}
            `;
            
            document.getElementById('suiteResult').innerHTML = summary;
        }

        // Individual test functions
        async function testAuth() {
            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'admin', password: 'admin123' })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    authToken = data.token;
                    return { name: 'Authentication', status: 'pass', message: 'Login successful' };
                } else {
                    return { name: 'Authentication', status: 'fail', message: 'Login failed' };
                }
            } catch (error) {
                return { name: 'Authentication', status: 'fail', message: error.message };
            }
        }

        async function testDashboard() {
            try {
                const response = await fetch(`${API_URL}/reports/dashboard?metric=users`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    return { name: 'Dashboard Reports', status: 'pass', message: 'Report generated' };
                } else {
                    return { name: 'Dashboard Reports', status: 'fail', message: 'Report failed' };
                }
            } catch (error) {
                return { name: 'Dashboard Reports', status: 'fail', message: error.message };
            }
        }

        async function testBeneficiary() {
            try {
                const response = await fetch(`${API_URL}/reports/beneficiary?report_type=progress`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    return { name: 'Beneficiary Reports', status: 'pass', message: 'Report generated' };
                } else {
                    return { name: 'Beneficiary Reports', status: 'fail', message: 'Report failed' };
                }
            } catch (error) {
                return { name: 'Beneficiary Reports', status: 'fail', message: error.message };
            }
        }

        async function testProgram() {
            try {
                const response = await fetch(`${API_URL}/reports/program/1?type=participants`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    return { name: 'Program Reports', status: 'pass', message: 'Report generated' };
                } else {
                    return { name: 'Program Reports', status: 'fail', message: 'Report failed' };
                }
            } catch (error) {
                return { name: 'Program Reports', status: 'fail', message: error.message };
            }
        }

        async function testCustom() {
            try {
                const response = await fetch(`${API_URL}/reports/custom`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: 'monthly_summary',
                        options: {
                            include_charts: true,
                            include_stats: true
                        }
                    })
                });
                
                if (response.ok) {
                    return { name: 'Custom Reports', status: 'pass', message: 'Report generated' };
                } else {
                    return { name: 'Custom Reports', status: 'fail', message: 'Report failed' };
                }
            } catch (error) {
                return { name: 'Custom Reports', status: 'fail', message: error.message };
            }
        }

        async function testTemplates() {
            try {
                const response = await fetch(`${API_URL}/reports/templates/monthly_summary`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    return { name: 'Templates', status: 'pass', message: 'Template loaded' };
                } else {
                    return { name: 'Templates', status: 'fail', message: 'Template failed' };
                }
            } catch (error) {
                return { name: 'Templates', status: 'fail', message: error.message };
            }
        }

        // Helper functions
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.className = `result ${type}`;
            element.textContent = message;
        }

        function viewReport(reportId) {
            window.open(`${API_URL}/reports/${reportId}/view`, '_blank');
        }

        function cancelSchedule(scheduleId) {
            // Implementation for canceling scheduled report
            showResult('scheduleResult', `Cancel schedule ${scheduleId}`, 'warning');
        }

        // Initialize
        window.onload = () => {
            if (authToken) {
                showResult('authResult', 'Using saved auth token', 'success');
            }
        };
    </script>
</body>
</html>